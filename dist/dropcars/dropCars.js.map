{"version":3,"sources":["dropcars/dropCars.ts"],"names":["G","_super","apply","this","arguments","count","v","ballList","score","__extends","prototype","newGame","createRole","call","control","running","role","draw","forEach","ball","createBoll","scoreScreen","change","drop","checkHits","_this","hits","over","gameOver","gameOverStage","setText","loading","console","log","Sprite","context","rect","stage","width","setSize","w","jump","bindEvent","epos","col","height","Math","ceil","bind","obj","x","setPosition","h","setBallInitPosition","min","colPos","rnd","random","i","Ball","floor","length","push","splice","index","JY","y","view","document","getElementById","offsetWidth","offsetHeight","Stage","descript","Discript","text","GameOver","title","Title","Control","game","files","image","setup"],"mappings":"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","file":"dropCars.js","sourcesContent":["/// <reference path=\"../../src/index.ts\" />\r\n(function () {\r\n    class G extends JY {\r\n        interval: 20;\r\n        count = 1;\r\n        role: Sprite;\r\n        v = 2;//速度 \r\n        ballList: Array<Ball> = [];//球的集合\r\n        score: number = 0;\r\n        scoreScreen:Score;\r\n        newGame() {\r\n            this.count = 1;\r\n            this.v = 2;\r\n            this.score = 0;\r\n            this.ballList = [];\r\n            //init\r\n            this.createRole();\r\n            super.newGame();\r\n            this.control();\r\n        }\r\n        running() {\r\n            super.running();\r\n            this.count++;\r\n            // console.log(this.count)\r\n            this.role.draw();\r\n            this.ballList.forEach(ball => {\r\n                ball.draw();\r\n            });\r\n            this.createBoll();\r\n            this.scoreScreen.change('您已行驶 '+ this.score+' 米');\r\n            this.drop();\r\n            this.checkHits();\r\n\r\n        }\r\n        checkHits(){\r\n            this.ballList.forEach(ball => {\r\n                if(this.hits(this.role,ball)){\r\n                    this.over()\r\n                }\r\n            });\r\n        }\r\n        gameOver() {\r\n            super.gameOver();\r\n            this.gameOverStage.setText('得分：'+this.score);\r\n        }\r\n        loading() {\r\n            console.log('loading...')\r\n            super.loading();\r\n        }\r\n        //创建英雄\r\n        createRole() {\r\n            this.role = new Sprite(this.context, 'car.png');\r\n            let rect = this.stage.width / 3 - 10;\r\n            this.role.setSize(rect, rect);\r\n            let x = this.stage.width / 2 - this.role.w / 2;\r\n            // this.role.setPosition(this.stage.width/3,this.stage.height - this.role.h);\r\n            this.jump(1, this.role);\r\n        }\r\n        //控制器\r\n        control() {\r\n            this.stage.bindEvent(function (epos) {\r\n                let w = this.stage.width;\r\n                let h = this.stage.height;\r\n                let col = Math.ceil(epos[0] / (w / 3));//分三栏，判断点击是哪一栏\r\n                this.jump(col, this.role);\r\n            }.bind(this));\r\n        }\r\n        //跳啊\r\n        jump(col: number, obj: Sprite) {\r\n            let x = this.stage.width / 3 * col - this.stage.width / 3 / 2 - this.role.w / 2;\r\n            obj.setPosition(x, this.stage.height / 2 + this.role.h);\r\n        }\r\n        //设置球的初始位置\r\n        setBallInitPosition(ball: Sprite, col: number) {\r\n            let x = this.stage.width / 3 * col - this.stage.width / 3 / 2 - ball.w / 2;\r\n            ball.setPosition(x, 0);\r\n        }\r\n        createBoll() {\r\n            //创建小球\r\n            if (this.count % 100 == 0) {\r\n                this.v = Math.min(this.v + .3,5);\r\n                this.score++;\r\n                //10帧创建\r\n                let colPos = [1, 2, 3];//三列中的某一列\r\n                let rnd = Math.ceil(Math.random() * 2);//创建一个或2;\r\n                let i = 0;\r\n                while (true) {\r\n                    let ball = new Ball(this.context, this.stage.width / 3 - 10, this.stage.width / 4);\r\n                    let col = Math.floor(Math.random() * colPos.length);\r\n                    this.setBallInitPosition(ball, colPos[col]);\r\n                    this.ballList.push(ball);\r\n                    colPos.splice(col, 1);\r\n                    i++;\r\n                    if (i >= rnd) {\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        drop() {\r\n            this.ballList.forEach((ball,index) => {\r\n                ball.drop(this.v);\r\n                if(ball.x >this.stage.height){\r\n                    this.ballList.splice(index,1)\r\n                }\r\n            });\r\n        }\r\n    }\r\n    class Ball extends Sprite {\r\n        constructor(context, w, h) {\r\n            super(context, 'car1.png');\r\n            this.setSize(w, h);\r\n        }\r\n        drop(v: number) {\r\n            this.setPosition(this.x, this.y + v)\r\n        }\r\n    }\r\n    let view = document.getElementById('view');\r\n    let w = view.offsetWidth;\r\n    let h = view.offsetHeight;\r\n    let stage = new Stage(w, h);\r\n    let descript = new Discript('start');\r\n    descript.text = '<p class=\"title\">碰撞汽车</p>'\r\n    let gameOver = new GameOver('restart');\r\n    let title = new Title('碰撞汽车');\r\n    let control = new Control();\r\n    control.rect = [100, 100]\r\n    let game = new G(view, stage, title, descript, gameOver);\r\n    game.files = { image: ['car1.png', 'car2.png', 'car.png'] };\r\n    game.setup();\r\n})();"]}