{"version":3,"sources":["index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["/// <reference path=\"sprite.ts\" />\r\n/// <reference path=\"title.ts\" />\r\n/// <reference path=\"descript.ts\" />\r\n/// <reference path=\"gameOver.ts\" />\r\n/// <reference path=\"stage.ts\" />\r\n/// <reference path=\"control.ts\" />\r\n//游戏主框架\r\nenum STATE {\r\n    loading,\r\n    title,\r\n    descript,\r\n    newGame,\r\n    running,\r\n    pause,\r\n    levelUp,\r\n    die,\r\n    gameOver\r\n}\r\nclass JY {\r\n    private func: Function = new Function;\r\n    private timer: any;\r\n    private currentState: STATE;\r\n    protected interval: number = 10;\r\n    protected context;\r\n    files: any;\r\n    constructor(public view: any, public stage: Stage, public titleStage: Title, public descriptStage: Discript, public gameOverStage?: GameOver, public controlStage?: Control) {\r\n        console.log(this.view)\r\n    }\r\n    setup() {\r\n        this.currentState = STATE.loading;\r\n        this.setState(STATE.loading);\r\n        document.addEventListener('touchmove', function (event) {\r\n            if (event.preventDefault) {\r\n                event.preventDefault();\r\n            } else {\r\n                window.event.returnValue == false;\r\n            }\r\n        });\r\n    }\r\n    createStage() {\r\n        console.log(this.stage)\r\n        let canvas = this.stage.create();\r\n        this.context = canvas.getContext('2d');\r\n        this.view.appendChild(canvas);\r\n    }\r\n    run() {\r\n        console.log('run')\r\n        //this.func();\r\n        this.descriptStage.remove();\r\n        this.createStage();//创建舞台\r\n        this.controlStage && this.createControl();\r\n        this.setState(STATE.newGame);\r\n    }\r\n    createControl() {\r\n        this.view.appendChild(this.controlStage.create());\r\n    }\r\n    //加载\r\n    loading() {\r\n        this.loadFile(function () {\r\n            this.setState(STATE.title)\r\n        }.bind(this));\r\n    }\r\n    loadFile(callback: Function) {\r\n        let _this = this;\r\n        let obj = {};\r\n        for (let v in _this.files) {\r\n            obj[v]={};\r\n            obj[v].count = 0;\r\n            let type = v;\r\n            console.log(_this.files[v])\r\n            for (let i = 0, l = _this.files[v].length; i < l; i++) {\r\n                let item = _this.files[v][i];\r\n                if (type == 'image') {\r\n                    let img = new Image();\r\n                    img.onload = function () {\r\n                        obj[v].count++;\r\n                        console.log(item + ' loaded');\r\n                        if (_this.checkLoaded(obj)) {\r\n                            callback.call(_this);\r\n                        }\r\n                    }\r\n                    img.src = item;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    checkLoaded(obj) {\r\n        for(var v in obj ){\r\n            if(obj[v].count != this.files[v].length){\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n    //标题\r\n    title() {\r\n        console.log('title')\r\n        let titleStage = this.titleStage.create(function () {\r\n            this.run();\r\n        }.bind(this));\r\n        this.view.appendChild(titleStage);\r\n        setTimeout(function () {\r\n            this.setState(STATE.descript)\r\n        }.bind(this), 1000);\r\n    }\r\n    //说明\r\n    descript() {\r\n        console.log('descript');\r\n        this.titleStage.remove();\r\n        let desc = this.descriptStage.create(function () {\r\n            this.run();\r\n        }.bind(this));\r\n        this.view.appendChild(desc);\r\n    }\r\n    //新的开始\r\n    protected newGame() {\r\n        //游戏开始，清空场景\r\n        //打开计时器\r\n        this.setState(STATE.running);\r\n        this.startTimer();\r\n    }\r\n    //结束 \r\n    protected over() {\r\n        this.setState(STATE.gameOver);\r\n    }\r\n    //暂停\r\n    protected pause() {\r\n        this.stopTimer();\r\n    }\r\n    //暂停后的继续\r\n    protected play() {\r\n        this.startTimer();\r\n    }\r\n    //游戏结束\r\n    protected gameOver() {\r\n        //游戏结束\r\n        //清空场景，显示结果\r\n        console.log('gameOver');\r\n        this.stage.remove();\r\n        this.controlStage && this.controlStage.remove();\r\n        this.stopTimer();\r\n        let gameOver = this.gameOverStage.create(function () {\r\n            gameOver.remove();\r\n            this.setState(STATE.descript);\r\n        }.bind(this));\r\n        this.view.appendChild(gameOver);\r\n    }\r\n    //停止刷新\r\n    stopTimer() {\r\n        clearInterval(this.timer);\r\n    }\r\n    //刷新帧\r\n    startTimer() {\r\n        let _this = this;\r\n        this.timer = setInterval(function () {\r\n            _this.func.bind(_this)();\r\n        }, this.interval)\r\n    }\r\n    //游戏中的\r\n    running() {\r\n        // console.log('running...')\r\n    }\r\n    //检查状态\r\n    checkState() {\r\n        switch (this.currentState) {\r\n            case STATE.loading:\r\n                this.func = this.loading;\r\n                break;\r\n            case STATE.title:\r\n                this.func = this.title;\r\n                break;\r\n            case STATE.descript:\r\n                this.func = this.descript;\r\n                break;\r\n            case STATE.newGame:\r\n                this.func = this.newGame;\r\n                break;\r\n            case STATE.running:\r\n                this.func = this.running;\r\n                break;\r\n            case STATE.gameOver:\r\n                this.func = this.gameOver;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    setState(state?: STATE) {\r\n        this.currentState = state;\r\n        this.checkState();\r\n        this.func();\r\n    }\r\n}"]}