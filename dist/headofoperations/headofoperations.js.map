{"version":3,"sources":["headofoperations/headofoperations.ts"],"names":["Ball","_super","context","w","h","name","url","score","call","this","Date","getTime","toString","substr","setSize","shape","SHAPE","circle","__extends","prototype","draw","angle","text","WriteText","write","x","y","r","drop","v","setPosition","eat","_this","setImg","setTimeout","Math","sqrt","Sprite","Robot","undefined","vx","vy","floor","random","index","names","length","splice","trans","atan2","move","stage","cos","sin","max","min","width","height","G","apply","arguments","roleSize","av","ballList","zdList","robotList","decompose","decomposeV","newGame","init","createRole","createZd","createRobot","createAccelerate","accelerate","Accelerate","view","appendChild","create","e","i","robot","push","role","createCopy","ball","running","createBallList","drawBallList","checkHits","drawZdList","drawRobot","moveScreen","scoreScreen","change","clientHeight","clientWidth","maxx","maxy","elem","style","left","top","forEach","item","zd","keyx","keyy","hits","j","over","obj","count","controlStage","getAngle","gameOver","gameOverStage","setText","remove","loading","console","log","JY","startCallback","endCallback","document","createElement","className","position","right","bottom","addEventListener","parentNode","removeChild","getElementById","offsetWidth","offsetHeight","Stage","descript","Discript","GameOver","title","Title","control","Control","rect","game","files","image","setup"],"mappings":"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","file":"headofoperations.js","sourcesContent":["/// <reference path=\"../../src/index.ts\" />\r\n/// <reference path=\"names.ts\" />\r\n(function () {\r\n    class Ball extends Sprite {\r\n        name: string = \"游客\" + (new Date().getTime()).toString().substr(-5);\r\n        url: string;\r\n        score: number = 0;\r\n        constructor(context: any, w: number, h: number, name?: string, url: string = 'head-a.png', score: number = 10) {\r\n            super(context, url);\r\n            this.score = score;\r\n            this.setSize();\r\n            this.url = url;\r\n            this.shape = SHAPE.circle;\r\n            this.name = name || this.name;\r\n        }\r\n        draw(angle?: number) {\r\n            this.setSize();\r\n            super.draw(angle);\r\n            let text = new WriteText(this.context);\r\n            text.write(this.name, this.x, this.y + this.r, null, '#cccccc')\r\n        }\r\n        drop(v: number) {\r\n            this.setPosition(this.x, this.y + v)\r\n        }\r\n        eat(url: string = 'eat-a.png') {\r\n            this.setImg(url);\r\n            setTimeout(() => this.setImg(this.url), 300);\r\n        }\r\n        setSize() {\r\n            //1分相当于math.pi*5*5\r\n            let r = Math.sqrt(this.score) * 5;\r\n            super.setSize(2 * r, 2 * r);\r\n        }\r\n    }\r\n    //机器人\r\n    class Robot extends Ball {\r\n        score: number = 0;\r\n        angle: number = 0;\r\n        v: number = 1;\r\n        vx: number = this.v;\r\n        vy: number = this.v;\r\n        constructor(public context: any) {\r\n            super(context, 10, 10, undefined, 'head.png');\r\n            let score = 10 + Math.floor(Math.random() * 10);\r\n            this.score = score;\r\n            let index = Math.floor(Math.random() * names.length - 1);;\r\n            this.name = names[index];\r\n            names.splice(index, 1);\r\n            this.trans();\r\n            this.setSize();\r\n        }\r\n        //随机更换方向\r\n        trans() {\r\n            this.angle = Math.atan2(-1 + Math.random() * 2, -1 + Math.random() * 2);\r\n            return this.angle;\r\n        }\r\n        move(stage: Stage) {\r\n            let angle = 0;\r\n            if (Math.random() * 1000 < 3) {\r\n                this.trans();\r\n            }\r\n            angle = - this.angle;\r\n            if (angle != 0) {\r\n                this.vx = Math.cos(angle) * this.v;\r\n                this.vy = Math.sin(angle) * this.v;\r\n            }\r\n            this.x = this.vx + this.x;\r\n            this.y = this.y - this.vy;\r\n            this.x = Math.max(0, this.x);\r\n            this.x = Math.min(this.x, stage.width - this.w);\r\n            this.y = Math.max(0, this.y);\r\n            this.y = Math.min(this.y, stage.height - this.h);\r\n            if (this.x == 0 || this.y == 0 || this.x == stage.width - this.w || this.y == stage.height - this.h) {\r\n                // console.log(this.x,this.y)\r\n                this.trans();\r\n            }\r\n        }\r\n        draw() {\r\n            super.draw(this.angle);\r\n        }\r\n        eat() {\r\n            super.eat('eat.png')\r\n        }\r\n    }\r\n    class G extends JY {\r\n        interval: 15;\r\n        role: Ball;\r\n        roleSize: number = 10;\r\n        v: number = 1;//速度 \r\n        av: number = 0;//加速度\r\n        vx: number = this.v;\r\n        vy: number = this.v;\r\n        ballList: Array<Sprite> = [];\r\n        score: number = 10;\r\n        zdList: Array<Sprite> = [];\r\n        angle: number;\r\n        robotList: Array<Robot> = [];\r\n        accelerate: Accelerate;\r\n        decompose: boolean = false;\r\n        decomposeV: number = 0;//分解速度\r\n        newGame() {\r\n            this.init();\r\n            this.createRole();\r\n            //创建5个炸弹\r\n            this.createZd();\r\n            this.createRobot();\r\n            super.newGame();\r\n            //\r\n            this.createAccelerate()//创建加速器\r\n        }\r\n        createAccelerate() {\r\n            this.accelerate = new Accelerate();\r\n            this.view.appendChild(this.accelerate.create((e) => {\r\n                this.v = 5;\r\n                this.decompose = true;\r\n            }, (e) => {\r\n                this.v = 1;\r\n                this.decompose = false;\r\n            }));\r\n        }\r\n        init() {\r\n            this.score = 10;\r\n            this.ballList = [];\r\n            this.zdList = [];\r\n            this.robotList = [];\r\n        }\r\n        createRobot() {\r\n            for (let i = this.robotList.length; i < 15; i++) {\r\n                let robot = new Robot(this.context);\r\n                robot.x = Math.random() * this.stage.width;\r\n                robot.y = Math.random() * this.stage.height;\r\n                robot.r = robot.h / 2;\r\n                this.robotList.push(robot);\r\n            }\r\n            this.decomposeV <= 0 ? this.decomposeV = 20 : undefined;\r\n            //加速时分解\r\n            if (this.decompose && this.decomposeV >= 20 && this.role.score > 0) {\r\n                // debugger;\r\n                // console.log('分解了')\r\n                this.decompose = false;\r\n                this.createCopy();\r\n                this.role.setSize();\r\n            }\r\n        }\r\n        //创建分身\r\n        createCopy() {\r\n            if (this.decomposeV >= 20) {\r\n                let ball: Robot = new Robot(this.context);\r\n                ball.name = '分身';\r\n                ball.score = this.role.score / 2;\r\n                ball.setSize();\r\n                ball.x = this.vx > 0 ? this.role.x + this.role.r - 1 * (this.vx + this.role.w) : this.role.x + this.role.w - this.vx;\r\n                ball.y = this.vy < 0 ? this.role.y + this.role.r - 1 * (this.vy + this.role.h) : this.role.y + this.role.h + this.vy;\r\n                ball.shape = SHAPE.circle;\r\n                ball.setPosition(ball.x, ball.y);\r\n                this.role.score = this.role.score / 2;\r\n                this.robotList.push(ball);\r\n            }\r\n        }\r\n        createRole() {\r\n            // this.role = new Sprite(this.context, 'head.png');\r\n            this.role = new Ball(this.context, this.roleSize, this.roleSize);\r\n            this.role.x = this.stage.width / 2;\r\n            this.role.y = this.stage.height / 2;\r\n            this.role.r = this.role.h / 2;\r\n        }\r\n        running() {\r\n            // console.log(this.controlStage.getAngle())\r\n            super.running();\r\n            this.move()\r\n            this.role.draw(this.angle);\r\n            this.createBallList();//创建小点点\r\n            this.drawBallList();\r\n            //吃小点\r\n            this.checkHits();\r\n            this.drawZdList();\r\n            //robot\r\n            this.drawRobot();\r\n            this.createRobot();\r\n            //移动视窗\r\n            this.moveScreen();\r\n\r\n            this.scoreScreen.change('得分：' + this.role.score.toString());\r\n\r\n            this.decomposeV > 0 ? this.decomposeV-- : undefined;\r\n        }\r\n        moveScreen() {\r\n            let h = this.view.clientHeight;\r\n            let w = this.view.clientWidth;\r\n            let x = Math.floor(this.role.x + this.role.r - w / 2);\r\n            let y = Math.floor(this.role.y + this.role.r - h / 2);\r\n            let maxx = this.stage.width - w;\r\n            let maxy = this.stage.height - h;\r\n            this.stage.elem.style.left = -Math.min(maxx, Math.max(0, x)) + 'px';\r\n            this.stage.elem.style.top = -Math.min(maxy, Math.max(0, y)) + 'px';\r\n        }\r\n        drawZdList() {\r\n            this.zdList.forEach(item => {\r\n                item.draw()\r\n            });\r\n        }\r\n        drawRobot() {\r\n            this.robotList.forEach(item => {\r\n                item.move(this.stage)\r\n                item.draw();\r\n            })\r\n        }\r\n        createZd() {\r\n            for (let i = 0; i < 4; i++) {\r\n                let zd: Sprite = new Sprite(this.context, 'zd.png');\r\n                this.zdList.push(zd);\r\n                zd.setSize(10, 10);\r\n                let keyx: number = this.stage.width / 4;\r\n                let keyy: number = this.stage.height / 4;\r\n                if (i == 0) {\r\n                    zd.setPosition(keyx, keyy);\r\n                }\r\n                if (i == 1) {\r\n                    zd.setPosition(this.stage.width - keyx, keyy);\r\n                }\r\n                if (i == 2) {\r\n                    zd.setPosition(keyx, this.stage.height - keyy);\r\n                }\r\n                if (i == 3) {\r\n                    zd.setPosition(this.stage.width - keyx, this.stage.height - keyy);\r\n                }\r\n                zd.shape = SHAPE.circle;\r\n                // console.log(zd.x,zd.y)\r\n            }\r\n        }\r\n        checkHits() {\r\n            this.ballList.forEach((ball, i) => {\r\n                if (this.hits(this.role, ball)) {\r\n                    this.role.score++;\r\n                    this.role.setSize()\r\n                    // delete this.ballList[i];\r\n                    this.ballList.splice(i, 1);\r\n                    this.role.eat();\r\n                }\r\n                this.robotList.forEach((item, j) => {\r\n                    if (this.hits(item, ball)) {\r\n                        item.score++;\r\n                        item.setSize()\r\n                        // delete this.ballList[i];\r\n                        this.ballList.splice(i, 1);\r\n                        item.eat();\r\n                    }\r\n                    if (this.hits(item, this.role)) {\r\n                        if (item.score > this.role.score) {\r\n                            this.over();\r\n                        } else if (item.score < this.role.score) {\r\n                            this.role.score += item.score;\r\n                            this.robotList.splice(j, 1);\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n            this.robotList.forEach((item, i) => {\r\n                this.robotList.forEach((obj, j) => {\r\n                    if (i != j && this.hits(item, obj) && item.score != obj.score) {\r\n                        if (item.score > obj.score) {\r\n                            item.score += obj.score;\r\n                            this.robotList.splice(j, 1);\r\n                        } else {\r\n                            obj.score += item.score;\r\n                            this.robotList.splice(i, 1);\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n            this.zdList.forEach((ball) => {\r\n                if (this.hits(this.role, ball)) {\r\n                    this.decomposeV <= 0 ? this.decomposeV = 20 : undefined;\r\n                    this.createCopy();\r\n                }\r\n                this.robotList.forEach((item, i) => {\r\n                    if (this.hits(item, ball)) {\r\n                        this.robotList.splice(i, 1);\r\n                    }\r\n                });\r\n            });\r\n        }\r\n        drawBallList() {\r\n            this.ballList.forEach(item => {\r\n                item.draw()\r\n            });\r\n        }\r\n        createBallList() {\r\n            let count: number = 300 - this.ballList.length;\r\n            for (let i = 0; i < count; i++) {\r\n                let ball: Sprite = new Sprite(this.context, 'head.png');\r\n                this.ballList.push(ball);\r\n                ball.setSize(5, 5);\r\n                ball.x = Math.random() * this.stage.width;\r\n                ball.y = Math.random() * this.stage.height;\r\n                ball.shape = SHAPE.circle;\r\n            }\r\n        }\r\n        move() {\r\n            let angle = this.controlStage.getAngle();\r\n            this.angle = -angle;\r\n            if (angle != 0) {\r\n                this.vx = Math.cos(angle) * this.v;\r\n                this.vy = Math.sin(angle) * this.v;\r\n            }\r\n            // console.log(this.angle)\r\n            // return;\r\n            this.role.x = this.vx + this.role.x;\r\n            this.role.y = this.role.y - this.vy;\r\n            this.role.x = Math.max(0, this.role.x);\r\n            this.role.x = Math.min(this.role.x, this.stage.width - this.role.w);\r\n            this.role.y = Math.max(0, this.role.y);\r\n            this.role.y = Math.min(this.role.y, this.stage.height - this.role.h)\r\n        }\r\n        gameOver() {\r\n            super.gameOver();\r\n            this.gameOverStage.setText('得分：' + this.role.score);\r\n            this.accelerate.remove();\r\n        }\r\n        loading() {\r\n            console.log('loading...')\r\n            super.loading();\r\n        }\r\n    }\r\n    //加速面板\r\n    class Accelerate implements IScreen {\r\n        elem: HTMLElement;\r\n        create(startCallback?: Function, endCallback?: Function) {\r\n            this.elem = document.createElement('div');\r\n            this.elem.className = \"accelerate\";\r\n            // this.elem.style.background = 'url(act.png) no-repeaat'\r\n            this.elem.style.position = 'absolute';\r\n            this.elem.style.right = '10%';\r\n            this.elem.style.bottom = '10%';\r\n            this.elem.addEventListener('touchstart', (e) => {\r\n                startCallback(e);\r\n            }, false);\r\n            this.elem.addEventListener('touchend', (e) => {\r\n                endCallback(e);\r\n            }, false);\r\n            return this.elem;\r\n        }\r\n        remove() {\r\n            this.elem && this.elem.parentNode.removeChild(this.elem);\r\n        }\r\n    }\r\n    setTimeout(function () {\r\n        let view = document.getElementById('view');\r\n        let w = view.offsetWidth;\r\n        let h = view.offsetHeight;\r\n        let stage = new Stage(w * 3, h * 3);\r\n        let descript = new Discript('start');\r\n        descript.text = '<p class=\"title\">大头吃小头</p>'\r\n        let gameOver = new GameOver('restart');\r\n        let title = new Title('大头吃小头');\r\n        let control = new Control();\r\n        control.rect = [100, 100]\r\n        let game = new G(view, stage, title, descript, gameOver, control);\r\n        game.files = { image: ['act.png', 'head.png', 'head-a.png', 'eat-a.png', 'eat.png', 'zd.png'] };\r\n        game.setup();\r\n    }, 1000)\r\n})();"]}