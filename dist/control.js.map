{"version":3,"sources":["control.ts"],"names":[],"mappings":"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","file":"control.js","sourcesContent":["/// <reference path=\"iScreen.ts\" />\r\n//操作界面\r\nclass Control implements IScreen {\r\n    elem: HTMLElement;\r\n    rect: Array<number> = [160, 160];\r\n    moveElem: HTMLElement;\r\n    moveRect: Array<Number> = [50, 50];\r\n    moveCenter: Array<any>;\r\n    elemCenter: Array<any>;\r\n    elemPosition: Array<Number> = [10, 10];\r\n    position: Array<any>;\r\n    toPosition:Array<number>;\r\n    private angle:number=0;//角度\r\n\r\n    create() {\r\n        this.elem = document.createElement('div');\r\n        this.elem.className = \"control\";\r\n        this.elem.style.position = 'absolute';\r\n        this.elem.style.width = this.rect[0] + 'px';\r\n        this.elem.style.height = this.rect[1] + 'px';\r\n        this.elem.style.left = this.elemPosition[0] + '%';\r\n        this.elem.style.bottom = this.elemPosition[1] + '%';\r\n        this.moveElem = document.createElement('div');\r\n        this.moveElem.className = 'move';\r\n        this.moveElem.style.position = 'absolute';\r\n        this.moveElem.style.width = this.moveRect[0] + 'px';\r\n        this.moveElem.style.height = this.moveRect[1] + 'px';\r\n        this.elem.appendChild(this.moveElem);\r\n        this.moveCenter = this.moveRect.map(function (d: number) { return d / 2 });\r\n        this.elemCenter = this.rect.map(function (d: number) { return d / 2 });\r\n        this.resetPos();\r\n        this.bindEvent();\r\n        return this.elem;\r\n    }\r\n    resetPos() {\r\n        //重置位置\r\n        // console.log(this.moveCenter)\r\n        this.toPosition = [0, 0];\r\n        this.transPosition();\r\n    }\r\n    //传入圆心转换成坐标,\r\n    transPosition() {\r\n        let x = (this.elemCenter[0] - this.moveCenter[0]) + this.toPosition[0];\r\n        let y = (this.elemCenter[1] - this.moveCenter[1]) - this.toPosition[1];\r\n        this.moveElem.style.left = x + 'px';\r\n        this.moveElem.style.top = y + 'px';\r\n\r\n    }\r\n    bindEvent() {\r\n        this.elem.addEventListener('touchstart', function (event:TouchEvent) {\r\n            let epos = event.touches[0] || event;\r\n            this.setPosition(epos)\r\n        }.bind(this), false);\r\n        this.elem.addEventListener('touchmove', function (event:TouchEvent) {\r\n            let epos = event.touches[0] || event;\r\n            this.setPosition(epos);\r\n        }.bind(this), false);\r\n        this.elem.addEventListener('touchend', function (event:TouchEvent) {\r\n            this.resetPos();\r\n        }.bind(this), false);\r\n    }\r\n    // 计算边界值,设置位置\r\n    setPosition(epos:Touch) {\r\n        this.position =  [this.elem.offsetLeft, this.elem.offsetTop];\r\n        let x: number = epos.pageX - this.position[0];\r\n        let y = epos.pageY - this.position[1];\r\n        // x= Math.min (x,this.rect[0]-this.moveCenter[0]);\r\n        // x = Math.max(x,this.moveCenter[0])\r\n        let x1 = (x - this.elemCenter[0]);//相对于圆点的位置\r\n        let y1 = -(y - this.elemCenter[1]);\r\n        console.log(x1, y1)\r\n        let ang = Math.atan2(y1, x1);\r\n        // this.angle = ang;\r\n        // console.log('角度：'+ang)\r\n        let c = Math.sqrt(x1 * x1 + y1 * y1);\r\n        let r = this.elemCenter[0] - this.moveCenter[0];//最长半径\r\n        if (c > r) {\r\n            // console.log('out', c)\r\n            let x2 = Math.cos(ang) * r;\r\n            let y2 = Math.sin(ang) * r;\r\n            //下面是另一种算法\r\n            // y2=y1*r/c;\r\n            // x2= x1*r/c;\r\n            // console.log('xy:', x1, y1)\r\n            // console.log('x2y2:',x2, y2)\r\n            x1 = x2;\r\n            y1 = y2;\r\n        }\r\n        this.toPosition = [x1, y1];\r\n        this.transPosition()\r\n    }\r\n    getAngle(){\r\n        // console.log(this.toPosition)\r\n        this.angle = Math.atan2(this.toPosition[1],this.toPosition[0]);\r\n        return this.angle;\r\n    }\r\n    //获取到角度\r\n    remove() {\r\n        this.elem.parentNode.removeChild(this.elem);\r\n    }\r\n}"]}